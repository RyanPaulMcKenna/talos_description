<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

	<xacro:property name="head_mass" value="0.20" />
        <xacro:property name="neck_offset" value="0.085" />
        <xacro:property name="head_offset" value="0.075" />
        <xacro:property name="neck_alignment" value="${PI/12}" />

        <xacro:include filename="$(find talos_description)/urdf/head/head.transmission.xacro" />
	
	<xacro:macro name="head" params="prefix parent *origin">
	
              <!-- Stationary neck which attaches to the torso by fixed link -->
              <link name="${prefix}talos_stationary_neck_link">
                  <mass value="${head_mass}"/>
                   <xacro:inertial_template mass="${head_mass}" length="${head_mass/12}" width="${head_mass/12}" height="${head_mass/12}"/>
		  <visual>
			<origin xyz="0 0 0" rpy="0 -${neck_alignment} 0"/>
			<geometry>
                           <mesh filename="package://talos_description/urdf/head/stationary_neck.stl" scale="${scale} ${scale} ${scale}" /> 
			</geometry>
			<material name="white"/>
		  </visual>
		  <collision>
                        <origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
			  <mesh filename="package://talos_description/urdf/head/stationary_neck.stl" scale="${scale} ${scale} ${scale}" /> 
			</geometry>
		  </collision>
		</link>

	      <!-- pan neck which attaches to the top of the stationary neck by continuous link -->
              <link name="${prefix}talos_pan_neck_link">
                  <mass value="${head_mass}"/>
                   <xacro:inertial_template mass="${head_mass}" length="${head_mass/12}" width="${head_mass/12}" height="${head_mass/12}"/>
		  <visual>
			<origin xyz="0 0 0" rpy="0 -${neck_alignment} 0"/>
			<geometry>
                           <mesh filename="package://talos_description/urdf/head/pan_neck.stl" scale="${scale} ${scale} ${scale}" /> 
			</geometry>
			<material name="white"/>
		  </visual>
		  <collision>
                        <origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
			  <mesh filename="package://talos_description/urdf/head/pan_neck.stl" scale="${scale} ${scale} ${scale}" /> 
			</geometry>
		  </collision>
		</link>

                 <!-- head which attackes to the pan unit, this is the tilt unit -->
		<link name="${prefix}talos_tilt_head_link">
                  <mass value="${head_mass}"/>
                   <xacro:inertial_template mass="${head_mass}" length="${head_mass/12}" width="${head_mass/12}" height="${head_mass/12}"/>
		  <visual>
			<origin xyz="0 ${head_offset} 0" rpy="0 0 0"/>
			<geometry>
                           <mesh filename="package://talos_description/urdf/head/tilt_head.stl" scale="${scale} ${scale} ${scale}" /> 
			</geometry>
			<material name="white"/>
		  </visual>
		  <collision>
                        <origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
			  <mesh filename="package://talos_description/urdf/head/tilt_head.stl" scale="${scale} ${scale} ${scale}" /> 
			</geometry>
		  </collision>
		</link>

               <!-- Join tilt head to pan neck -->
               <joint name="${prefix}talos_tilt_head_joint" type="revolute">
                   <origin xyz="0 0 0" rpy="0 0 0"/>
                   <child link="${prefix}talos_tilt_head_link"/>
                   <parent link="${prefix}talos_pan_neck_link"/>
                   <axis xyz="0 1 0" rpy="0 0 0"/>
                   <!-- <limit effort="100"
                          velocity="100" />
                   <joint_properties damping="0.0"
                                     friction="0.0" /> -->
               </joint>

               <!-- Join stationary neck to torso (fixed) -->
               <joint name="${prefix}talos_neck_joint" type="fixed">
                   <xacro:insert_block name="origin"/>
                   <child link="${prefix}talos_neck_link"/>
                   <parent link="${parent}"/>
                   <axis xyz="0 1 0" rpy="0 0 0"/>
                   <!-- <limit effort="100"
                          velocity="100" />
                   <joint_properties damping="0.0"
                                     friction="0.0" /> -->
               </joint>

               <!-- Join pan neck to stationary neck (rotational by 360) -->
               <joint name="${prefix}talos_pan_neck_joint" type="continuous">
                   <origin xyz="0 0 0" rpy="0 0 0"/>
                   <child link="${prefix}talos_neck_link"/>
                   <parent link="${prefix}talos_stationary_neck_link"/>
                   <axis xyz="0 1 0" rpy="0 0 0"/>
                   <!-- <limit effort="100"
                          velocity="100" />
                   <joint_properties damping="0.0"
                                     friction="0.0" /> -->
               </joint>

               <gazebo reference="${prefix}talos_pan_neck_link">
                     <selfCollide>true</selfCollide>
	       </gazebo>

               <gazebo reference="${prefix}talos_tilt_head_link">
                     <selfCollide>true</selfCollide>
	       </gazebo>

               <gazebo reference="${prefix}talos_stationary_neck_link">
                     <selfCollide>true</selfCollide>
	       </gazebo>

         <!-- <xacro:talos_head_transmission prefix=""/> -->

	</xacro:macro>

</robot>
